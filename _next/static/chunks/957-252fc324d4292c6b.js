"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{98159:function(e,r,n){n.d(r,{W:function(){return l}});var t=n(52322),o=(n(2784),n(62620)),i=n(87653);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var l=function(e){var r=(0,o.If)().colorMode;return(0,t.jsx)(i.kC,function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){a(e,r,n[r])}))}return e}({direction:"row",alignItems:"center",justifyContent:"flex-start",width:"100vw",bg:{light:"gray.50",dark:"gray.900"}[r],color:{light:"black",dark:"white"}[r]},e))}},66851:function(e,r,n){n.d(r,{Y:function(){return le}});var t=n(52322),o=n(62620),i=n(87653),a=n(73955),l=n(13658),u=n(2784),c=n(91914),s=n(92021),f=n.n(s),d=n(37643),p=n(67691),h=n(85674),y=n(51996),v=n(28789),b=n(47177),g=n(46240),m=n(59917),w=n(31186),x=n(8799),j=n(41580),O=n(88513),k=n(56752),S=n(65413),P=n(32439),C=n(95496),A=n(11929),I=n(89141),E=n(74022),W=n(67199);function K(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function _(e,r){if(null==e)return{};var n,t,o=function(e,r){if(null==e)return{};var n,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||(o[n]=e[n]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function D(e){var r,n,o=e.id,i=e.label,a=e.help,l=e.children,u=e.errors,c=_(e,["id","label","help","children","errors"]);return(0,t.jsxs)(W.NI,function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){K(e,r,n[r])}))}return e}({id:o},c,{children:[i&&(0,t.jsx)(W.lX,{htmlFor:o,children:i}),l,(u[o]||a)&&(0,t.jsx)(W.Q6,{color:(null===(r=u[o])||void 0===r?void 0:r.message)&&"red.400",children:(null===(n=u[o])||void 0===n?void 0:n.message)||a})]}))}function U(e,r,n,t,o,i,a){try{var l=e[i](a),u=l.value}catch(c){return void n(c)}l.done?r(u):Promise.resolve(u).then(t,o)}function z(e){return function(){var r=this,n=arguments;return new Promise((function(t,o){var i=e.apply(r,n);function a(e){U(i,t,o,a,l,"next",e)}function l(e){U(i,t,o,a,l,"throw",e)}a(void 0)}))}}function M(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function N(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){M(e,r,n[r])}))}return e}function F(e){return function(e){if(Array.isArray(e)){for(var r=0,n=new Array(e.length);r<e.length;r++)n[r]=e[r];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var L=S.object({username:S.string().required().min(1),imageUrl:S.string()});function R(e,r){return T.apply(this,arguments)}function T(){return(T=z(f().mark((function e(r,n){var t,o,i,a,l,u,c,s,d,p,h,y;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=23;break}return e.next=5,r.initializeProfileInstructions({username:n.username,imageUrl:n.imageUrl});case 5:return a=e.sent,l=a.instructions,u=a.signers,e.next=10,r.initializeDelegateWalletInstructions({});case 10:return c=e.sent,s=c.output.delegateWalletKeypair,d=c.instructions,p=c.signers,(t=l).push.apply(t,F(d)),(o=u).push.apply(o,F(p)),l.push(m.yc.transfer({fromPubkey:r.wallet.publicKey,toPubkey:s.publicKey,lamports:1e8})),e.next=19,(0,E.sendInstructions)(r.errors||new Map,r.provider,l,u);case 19:h=localStorage.getItem("delegateWallet"),(y=h?JSON.parse(h):{})[null===(i=r.wallet.publicKey)||void 0===i?void 0:i.toBase58()]=Array.from(s.secretKey),localStorage.setItem("delegateWallet",JSON.stringify(y));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){var e=(0,P.cI)({resolver:(0,C.X)(L),defaultValues:{}}),r=(0,b.useWallet)().disconnect,n=e.register,o=e.handleSubmit,l=e.formState,u=l.errors,c=(l.isSubmitting,(0,A.useAsyncCallback)(R)),s=c.execute,d=c.loading,h=c.error,y=(0,I.FA)().chatSdk,v=(0,w.useProvider)().awaitingApproval;function g(){return(g=z(f().mark((function e(r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(y,r);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,(0,w.useErrorHandler)().handleErrors)(h),(0,t.jsx)(p.u_,{isOpen:!0,onClose:function(){r()},size:"2xl",isCentered:!0,trapFocus:!0,children:(0,t.jsxs)(p.hz,{borderRadius:"xl",shadow:"xl",children:[(0,t.jsx)(p.xB,{children:"Create Chat Profile"}),(0,t.jsx)(p.fe,{children:(0,t.jsx)(P.RV,N({},e,{children:(0,t.jsx)("form",{onSubmit:o((function(e){return g.apply(this,arguments)})),children:(0,t.jsxs)(i.gC,{children:[(0,t.jsxs)(O.bZ,{status:"info",children:[(0,t.jsx)(O.zM,{}),(0,t.jsxs)(i.xu,{children:[(0,t.jsx)(O.Cd,{children:"Local Wallet"}),(0,t.jsx)(O.X,{children:"Strata Chat is fully decentralized. In order to avoid asking for approval on every message, we create a wallet stored in your machines localStorage that can send messages on your main wallets behalf. Creating a profile will also load this wallet with 0.1 Sol to pay for messages (0.000005 SOL each) and file uploads (1 $SHDW per GB)"})]})]}),(0,t.jsx)(D,{id:"username",help:"A less than 32 character username. This will show as your name in the chat. These must be unique.",label:"Username",errors:u,children:(0,t.jsx)(k.II,N({},n("username")))}),(0,t.jsx)(D,{id:"imageUrl",help:"A url to the image to use for your profile",label:"Image URL",errors:u,children:(0,t.jsx)(k.II,N({},n("imageUrl")))}),(0,t.jsx)(a.zx,{isLoading:d,colorScheme:"primary",alignSelf:"flex-end",mr:3,type:"submit",loadingText:v?"Awaiting Approval":"Loading",children:"Save"})]})})}))})]})})}function J(e,r,n,t,o,i,a){try{var l=e[i](a),u=l.value}catch(c){return void n(c)}l.done?r(u):Promise.resolve(u).then(t,o)}function q(e){return function(){var r=this,n=arguments;return new Promise((function(t,o){var i=e.apply(r,n);function a(e){J(i,t,o,a,l,"next",e)}function l(e){J(i,t,o,a,l,"throw",e)}a(void 0)}))}}function G(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function H(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){G(e,r,n[r])}))}return e}function V(e,r){if(null==e)return{};var n,t,o=function(e,r){if(null==e)return{};var n,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||(o[n]=e[n]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function X(e){return function(e){if(Array.isArray(e)){for(var r=0,n=new Array(e.length);r<e.length;r++)n[r]=e[r];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Q(e){return Y.apply(this,arguments)}function Y(){return(Y=q(f().mark((function e(r){var n,t,o,i,a,l,u,c,s,d,p;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=20;break}return i=[],a=[],e.next=7,r.initializeDelegateWalletInstructions({});case 7:return l=e.sent,u=l.output.delegateWalletKeypair,c=l.instructions,s=l.signers,(n=i).push.apply(n,X(c)),(t=a).push.apply(t,X(s)),i.push(m.yc.transfer({fromPubkey:r.wallet.publicKey,toPubkey:u.publicKey,lamports:1e7})),e.next=16,(0,E.sendInstructions)(r.errors||new Map,r.provider,i,a);case 16:d=localStorage.getItem("delegateWallet"),(p=d?JSON.parse(d):{})[null===(o=r.wallet.publicKey)||void 0===o?void 0:o.toBase58()]=Array.from(u.secretKey),localStorage.setItem("delegateWallet",JSON.stringify(p));case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=function(e){var r=e.children,n=void 0===r?"Select Wallet":r,i=e.onClick,c=V(e,["children","onClick"]),s=(0,b.useWallet)(),f=s.connected,m=s.publicKey,O=(0,g.hB)(),k=O.visible,S=O.setVisible,P=(0,j.l0)(),C=P.info,E=P.loading,W=(0,d.d)(),K=(0,I.FA)().chatSdk,_=(0,w.useErrorHandler)().handleErrors,D=(0,A.useAsyncCallback)(Q),U=D.execute,z=D.error,M=D.loading;_(z),(0,u.useEffect)((function(){C&&!W&&U(K)}),[C,W]);var N=(0,u.useCallback)((function(e){i&&i(e),e.defaultPrevented||S(!k)}),[i,k,S]),F=(0,w.useEndpoint)(),L=F.cluster,R=F.setClusterOrEndpoint;return(0,t.jsxs)(a.hE,{marginTop:"auto",colorScheme:"primary",color:(0,o.ff)("black","white"),variant:"outline",spacing:"6",isAttached:!0,size:c.size,children:[!E&&f&&!C&&!W&&(0,t.jsx)(B,{}),M&&(0,t.jsx)(p.u_,{isOpen:!0,onClose:function(){},children:(0,t.jsx)(p.hz,{children:(0,t.jsx)(p.fe,{children:"Loading local wallet..."})})}),(0,t.jsx)(a.zx,H({color:(0,o.ff)("black","white"),borderColor:"primary.500"},c,{leftIcon:C?(0,t.jsx)(h.qE,{w:"30px",h:"30px",src:C.imageUrl}):(0,t.jsx)(l.JO,{w:"16px",h:"16px",as:x.BsFillPersonFill}),onClick:N,_hover:{backgroundColor:"orange.500"},children:f?C?C.username:(0,w.truncatePubkey)(m):n})),(0,t.jsxs)(y.v2,{isLazy:!0,children:[(0,t.jsx)(y.j2,{as:a.hU,color:(0,o.ff)("black","white"),borderColor:"primary.500",borderLeft:"none","aria-label":"Network",icon:(0,t.jsx)(l.JO,{as:x.BsChevronDown})}),(0,t.jsx)(y.qy,{backgroundColor:(0,o.ff)("white","black.300"),borderColor:"black.500",children:(0,t.jsxs)(y.__,{title:"Network",type:"radio",onChange:function(e){return R(e)},value:L,children:[(0,t.jsx)(y.ii,{value:v.WalletAdapterNetwork.Mainnet,_focus:{backgroundColor:"primary.300"},_hover:{backgroundColor:"primary.500"},children:"Mainnet"}),(0,t.jsx)(y.ii,{_focus:{backgroundColor:"primary.300"},_hover:{backgroundColor:"primary.500"},value:v.WalletAdapterNetwork.Devnet,children:"Devnet"}),(0,t.jsx)(y.ii,{_focus:{backgroundColor:"primary.300"},_hover:{backgroundColor:"primary.500"},value:"localnet",children:"Localnet"})]})})]})]})},$=n(71591),ee=n(5632),re=n(67630),ne=n(88712),te={path:"/chats/:id",params:["id"]};function oe(e,r){var n=void 0===r?{}:r,t=e.params.reduce((function(e,r){if(n[r]){var t=e.replaceAll(":".concat(r),n[r]);return delete n[r],t}return e}),e.path),o=window.location.search,i=new URLSearchParams(o||"").get("cluster");i&&!n.cluster&&(n.cluster=i);var a,l=new URLSearchParams((a=n,Object.keys(a).reduce((function(e,r){return"undefined"!==typeof a[r]&&(e[r]=a[r]),e}),{}))).toString();return t+(l?"?".concat(l):"")}function ie(e){var r=e.identifier,n=(0,ne.l)(r),a=(0,re.R)(n),l=a.info,u=a.loading,c=(0,o.If)().colorMode,s=(0,ee.useRouter)(),f=s.query.id,d=(0,o.ff)("gray.200","gray.800");return(0,t.jsxs)(i.kC,{minW:"200px",align:"center",bg:f==(null===l||void 0===l?void 0:l.identifier)?d:void 0,p:4,cursor:"pointer",_hover:{bg:"light"===c?"gray.200":"gray.700"},onClick:function(){s.push(oe(te,{id:null===l||void 0===l?void 0:l.identifier}))},children:[u?(0,t.jsx)($.s7,{mr:2}):(0,t.jsx)(h.qE,{mr:2,size:"md",src:null===l||void 0===l?void 0:l.imageUrl}),u?(0,t.jsx)($.N2,{width:"200px"}):(0,t.jsx)(i.xv,{children:null===l||void 0===l?void 0:l.name})]})}var ae=["open"],le=function(e){var r=e.fullWidth,n=(0,o.If)(),u=n.colorMode,s=n.toggleColorMode;return(0,t.jsxs)(i.kC,{height:"100vh",maxWidth:r?"100vw":"30vw",width:r?"100vw":"",direction:"column",borderRight:"1px solid",borderColor:"light"===u?"gray.200":"gray.700",children:[(0,t.jsx)(i.kC,{flexWrap:"wrap",direction:"column",position:"sticky",top:"0",children:(0,t.jsx)(i.kC,{justify:"space-between",height:"71px",align:"center",p:"10px",children:(0,t.jsxs)(i.Kq,{maxWidth:"30vw",direction:"row",w:"full",align:"space-between",justifyContent:"space-evenly",children:[(0,t.jsx)(Z,{}),(0,t.jsx)(a.hU,{colorScheme:"primary",variant:"outline","aria-label":"Toggle Dark Mode",icon:"light"===u?(0,t.jsx)(l.JO,{as:c.nmq}):(0,t.jsx)(l.JO,{as:c.vQG}),onClick:s})]})})}),(0,t.jsx)(i.Kq,{direction:"column",overflow:"scroll",children:ae.map((function(e){return(0,t.jsx)(ie,{identifier:e},e)}))})]})}},89141:function(e,r,n){n.d(r,{FA:function(){return t.FA}});var t=n(75960)},41580:function(e,r,n){n.d(r,{RJ:function(){return t.R},Un:function(){return s},l0:function(){return d}});var t=n(67630),o=(n(88712),n(59917)),i=n(63182),a=n(11929);var l=n(47177),u=n(31186),c=n(75960),s=function(e){var r=(0,c.FA)().chatSdk;return(0,u.useAccount)(e,null===r||void 0===r?void 0:r.profileDecoder)};function f(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function d(){var e=function(e){var r,n=(0,a.useAsync)((function(e,r){return i.ChatSdk.profileKey({wallet:e?new o.nh(e):void 0,username:r})}),[null===(r=e.wallet)||void 0===r?void 0:r.toBase58(),e.username]),t=n.result;return{loading:n.loading,key:t?t[0]:void 0}}({wallet:(0,l.useWallet)().publicKey||void 0}),r=e.key,n=e.loading,t=s(r);return function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){f(e,r,n[r])}))}return e}({},t,{loading:t.loading||n})}n(49433),n(37643)},67630:function(e,r,n){n.d(r,{R:function(){return i}});var t=n(31186),o=n(75960),i=function(e){var r=(0,o.FA)().chatSdk;return(0,t.useAccount)(e,null===r||void 0===r?void 0:r.chatDecoder)}},88712:function(e,r,n){n.d(r,{l:function(){return u}});var t=n(92021),o=n.n(t),i=n(63182),a=n(11929);function l(e,r,n,t,o,i,a){try{var l=e[i](a),u=l.value}catch(c){return void n(c)}l.done?r(u):Promise.resolve(u).then(t,o)}function u(e){var r,n=(0,a.useAsync)((r=o().mark((function e(r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r&&i.ChatSdk.chatKey(r));case 1:case"end":return e.stop()}}),e)})),function(){var e=this,n=arguments;return new Promise((function(t,o){var i=r.apply(e,n);function a(e){l(i,t,o,a,u,"next",e)}function u(e){l(i,t,o,a,u,"throw",e)}a(void 0)}))}),[e]).result;return n?n[0]:void 0}},37643:function(e,r,n){n.d(r,{d:function(){return u}});var t=n(47177),o=n(59917),i=n(31186),a=n(2784);function l(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var n=[],t=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(t=(a=l.next()).done)&&(n.push(a.value),!r||n.length!==r);t=!0);}catch(u){o=!0,i=u}finally{try{t||null==l.return||l.return()}finally{if(o)throw i}}return n}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(){var e=(0,t.useWallet)().publicKey,r=l((0,i.useLocalStorage)("delegateWallet",void 0),1)[0],n=(0,a.useMemo)((function(){if(r&&e)try{return JSON.parse(localStorage.delegateWallet)[null===e||void 0===e?void 0:e.toBase58()]}catch(n){console.error(n)}}),[r,null===e||void 0===e?void 0:e.toBase58()]);return(0,a.useMemo)((function(){return n&&o.RG.fromSecretKey(new Uint8Array(n))}),[n])}},49433:function(e,r,n){n.d(r,{y:function(){return v}});var t=n(92021),o=n.n(t),i=n(31186),a=n(2784),l=n(11929),u=n(89141);function c(e,r,n,t,o,i,a){try{var l=e[i](a),u=l.value}catch(c){return void n(c)}l.done?r(u):Promise.resolve(u).then(t,o)}function s(e){return function(){var r=this,n=arguments;return new Promise((function(t,o){var i=e.apply(r,n);function a(e){c(i,t,o,a,l,"next",e)}function l(e){c(i,t,o,a,l,"throw",e)}a(void 0)}))}}function f(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function d(e,r){if(null==e)return{};var n,t,o=function(e,r){if(null==e)return{};var n,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||(o[n]=e[n]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p={};function h(e,r){return y.apply(this,arguments)}function y(){return(y=s(o().mark((function e(r,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||!n){e.next=4;break}return e.next=3,Promise.all(n.map(s(o().mark((function e(n){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p[n]){e.next=2;break}return e.abrupt("return",p[n]);case 2:return e.next=4,r.getMessagesFromTx(n);case 4:return t=e.sent,p[n]=t,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})))));case 3:return e.abrupt("return",e.sent.flat());case 4:return e.abrupt("return",[]);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){var r=(0,u.FA)().chatSdk,n=(0,i.useTransactions)({address:e,numTransactions:50,subscribe:!0}),t=n.transactions,o=d(n,["transactions"]),c=(0,a.useState)(),s=c[0],p=c[1],y=(0,a.useMemo)((function(){return t.map((function(e){return e.signature})).reverse()}),[t]),v=(0,l.useAsync)(h,[r,y]),b=v.result,g=v.loading,m=v.error;return(0,a.useEffect)((function(){b&&p(b)}),[b]),function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){f(e,r,n[r])}))}return e}({},o,{loadingInitial:o.loadingInitial||g,error:o.error||m,messages:s})}}}]);