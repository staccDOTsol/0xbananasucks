(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[346],{36068:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chats/[id]",function(){return t(77462)}])},77462:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return he}});var r=t(52322),i=t(2517),o=t(87653),s=t(2784),a=t(92021),l=t.n(a),c=t(71591),u=t(62620),d=t(85674),f=t(73851),p=t(13658),h=t(48307),x=t(16326),v=t(47177),g=t(63182),y=t(31186),m=t(89587),j=t(11929),w=t(8799),b=t(34406).env.NEXT_PUBLIC_GIPHY_API_KEY,k=t(41580),P=t(20210),O=t(73955),S=t(67691),A=t(69704),C=t(46240);function M(e){var n=e.mint,t=(0,P.qY)(),i=t.isOpen,o=t.onToggle,s=t.onClose,a=(0,y.useTokenMetadata)(n).metadata,l=(0,v.useWallet)().connected,c=(0,y.useTokenBondingKey)(n,0),u=c.result,d=c.loading,f=(0,C.hB)().setVisible;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(O.zx,{size:"sm",colorScheme:"primary",variant:"outline",onClick:l?o:function(){return f(!0)},children:l?"Buy More ".concat(null===a||void 0===a?void 0:a.data.symbol):"Connect Wallet"}),(0,r.jsx)(S.u_,{isOpen:i,onClose:s,size:"2xl",isCentered:!0,trapFocus:!0,children:(0,r.jsxs)(S.hz,{borderRadius:"xl",shadow:"xl",children:[(0,r.jsxs)(S.xB,{children:["Buy More ",null===a||void 0===a?void 0:a.data.symbol]}),(0,r.jsxs)(S.fe,{minH:"500px",children:[u&&(0,r.jsx)(y.Swap,{tokenBondingKey:u,onConnectWallet:function(){s(),f(!0)}}),d&&(0,r.jsx)(A.$,{})]})]})})]})}function E(e,n,t,r,i,o,s){try{var a=e[o](s),l=a.value}catch(c){return void t(c)}a.done?n(l):Promise.resolve(l).then(r,i)}function T(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function s(e){E(o,r,i,s,a,"next",e)}function a(e){E(o,r,i,s,a,"throw",e)}s(void 0)}))}}var I=new h.GiphyFetch(b);function K(e){return R.apply(this,arguments)}function R(){return(R=T(l().mark((function e(n){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=5;break}return e.next=3,I.gif(n);case 3:return t=e.sent.data,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){var n=e.gifyId,t=(0,j.useAsync)(K,[n]),i=t.result;return t.loading||!i?(0,r.jsx)(c.Od,{w:"300px",h:"300px"}):(0,r.jsx)(x.Gif,{gif:i,width:300})}function _(e){var n=e.decodedMessage,t=e.profileKey,i=e.readPermissionAmount,s=e.chatKey,a=e.pending,l=void 0!==a&&a,c=(0,u.If)().colorMode,h=(0,v.useWallet)().publicKey,x=(0,k.Un)(t).info,j=null===x||void 0===x?void 0:x.ownerWallet.toBase58(),b=(0,k.RJ)(s).info,P=null===b||void 0===b?void 0:b.readPermissionMint,O=(0,y.useMint)(P),S=null===h||void 0===h?void 0:h.toBase58(),A=l?"Pending":"Confirmed",C=(0,u.ff)("red.600","red.400"),E=n;return(0,r.jsxs)(o.Ug,{w:"full",align:"start",spacing:2,children:[(0,r.jsx)(d.qE,{mt:"6px",size:"sm",src:null===x||void 0===x?void 0:x.imageUrl}),(0,r.jsxs)(o.gC,{w:"full",align:"start",spacing:0,children:[(0,r.jsx)(o.xv,{fontSize:"sm",fontWeight:"semibold",color:S==j?"blue.500":{light:"green.500",dark:"green.200"}[c],children:null===x||void 0===x?void 0:x.username}),(0,r.jsx)(o.xu,{w:"fit-content",position:"relative",textAlign:"left",wordBreak:"break-word",color:{light:"black",dark:"white"}[c],children:E?E.type===g.MessageType.Gify?(0,r.jsx)(B,{gifyId:E.gifyId}):E.type===g.MessageType.Image?(0,r.jsx)(f.Ee,{mt:"4px",alt:E.text,height:"300px",src:(E.attachments||[])[0]||U((E.decryptedAttachments||[])[0])}):(0,r.jsx)(o.xv,{mt:"-4px",children:E.text}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.xv,{color:C,fontStyle:"italic",mb:2,children:i&&O?"You need at least ".concat((0,y.roundToDecimals)((0,m.toNumber)(i,O),O.decimals)," tokens to read this message."):"You do not have enough tokens to read this message."}),(0,r.jsx)(M,{mint:P})]})})]}),(0,r.jsx)(p.JO,{alignSelf:"center",w:"12px",h:"12px",as:l?w.BsCircle:w.BsCheckCircleFill,color:"gray",title:A})]})}function U(e){if(e)return(window.URL||window.webkitURL).createObjectURL(e)}function z(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function W(e){var n=e.scrollRef,t=e.messages,i=e.pendingMessages,a=(0,k.l0)().info;return(0,s.useEffect)((function(){t&&n.current.scrollIntoView()}),[t]),(0,r.jsxs)(o.gC,{grow:"1",align:"start",overflowY:"scroll",spacing:2,h:"full",p:"10px",children:[null===t||void 0===t?void 0:t.map((function(e){return(0,r.jsx)(_,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){z(e,n,t[n])}))}return e}({},e),null===e||void 0===e?void 0:e.id)})),null===i||void 0===i?void 0:i.map((function(e,n){return(0,r.jsx)(_,{profileKey:null===a||void 0===a?void 0:a.publicKey,txid:e.txid,decodedMessage:e.content,pending:!0},(null===e||void 0===e?void 0:e.txid)+n)})),(0,r.jsx)("div",{ref:n})]})}var F=t(56752),G=t(59917),Y=t(74022),D=t(951),N=t(89141),H=t(37643),q=t(85819);function J(e,n,t,r,i,o,s){try{var a=e[o](s),l=a.value}catch(c){return void t(c)}a.done?n(l):Promise.resolve(l).then(r,i)}function L(e){var n=e.onUpload,t=s.useRef(null),i=(0,j.useAsyncCallback)(n),o=i.execute,a=i.loading,c=i.error;(0,(0,y.useErrorHandler)().handleErrors)(c);var u,d=(u=l().mark((function e(n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.target.files[0],e.prev=1,e.next=4,o(r);case 4:return e.prev=4,t.current&&(t.current.value=""),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])})),function(){var e=this,n=arguments;return new Promise((function(t,r){var i=u.apply(e,n);function o(e){J(i,t,r,o,s,"next",e)}function s(e){J(i,t,r,o,s,"throw",e)}o(void 0)}))});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{id:"image",type:"file",accept:".png,.jpg,.gif,.mp4,.svg",multiple:!1,onChange:d,ref:t,style:{display:"none"}}),(0,r.jsx)(O.hU,{isLoading:a,size:"lg","aria-label":"Select Image",variant:"outline",onClick:function(){return t.current.click()},icon:(0,r.jsx)(p.JO,{w:"24px",h:"24px",as:q.sUm})})]})}function X(e){var n=e.onSelect;return(0,r.jsx)(x.SearchContextManager,{apiKey:b,children:(0,r.jsx)(V,{onSelect:n})})}var V=function(e){var n=e.onSelect,t=(0,s.useContext)(x.SearchContext),i=t.fetchGifs,a=t.searchKey;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.SearchBar,{}),(0,r.jsx)(o.xu,{w:"full",mt:2,children:(0,r.jsx)(x.SuggestionBar,{})}),(0,r.jsx)(o.xu,{maxH:"500px",overflow:"auto",mt:4,children:(0,r.jsx)(x.Grid,{columns:3,width:625,fetchGifs:i,onGifClick:function(e,t){t.preventDefault(),n(String(e.id))}},a)})]})};function $(e,n,t,r,i,o,s){try{var a=e[o](s),l=a.value}catch(c){return void t(c)}a.done?n(l):Promise.resolve(l).then(r,i)}function Q(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function s(e){$(o,r,i,s,a,"next",e)}function a(e){$(o,r,i,s,a,"throw",e)}s(void 0)}))}}function Z(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ee(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){Z(e,n,t[n])}))}return e}function ne(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function te(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function re(e){var n=e.scrollRef,t=e.chatKey,i=e.onAddPendingMessage,a=(0,s.useState)(""),c=a[0],u=a[1],d=(0,P.qY)(),f=d.isOpen,h=d.onToggle,x=d.onClose,v=(0,N.FA)().chatSdk,j=(0,H.d)(),w=(0,s.useState)(),b=w[0],A=(w[1],(0,y.useErrorHandler)().handleErrors),C=(0,k.RJ)(t).info,E=(0,y.useOwnedAmount)(null===C||void 0===C?void 0:C.postPermissionMint),T=(0,y.useMint)(null===C||void 0===C?void 0:C.postPermissionMint),I=(null===C||void 0===C?void 0:C.postPermissionAmount)&&T&&(0,m.toNumber)(null===C||void 0===C?void 0:C.postPermissionAmount,T),K="undefined"==typeof I||"undefined"==typeof E||E>=I;A(b);var R=Q(l().mark((function e(r){var o,s,a,c,d,f,p,h,x,g;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j){e.next=24;break}if(!v||!t){e.next=24;break}return u(""),e.next=6,v.sendMessageInstructions({delegateWalletKeypair:j,payer:j.publicKey,chat:t,message:r,encrypted:!0});case 6:return a=e.sent,c=a.instructions,d=a.signers,f=new G.YW,e.next=12,v.provider.connection.getRecentBlockhash();case 12:return f.recentBlockhash=e.sent.blockhash,f.feePayer=j.publicKey,(o=f).add.apply(o,te(c)),(s=f).sign.apply(s,te(d)),p=f.serialize(),e.next=19,v.provider.connection.sendRawTransaction(p,{skipPreflight:!0});case 19:return h=e.sent,i&&(x=r.fileAttachments,g=ne(r,["fileAttachments"]),i({content:ee({},g,{decryptedAttachments:x}),txid:h,chatKey:t})),n.current.scrollIntoView({behavior:"smooth"}),e.next=24,(0,Y.sendAndConfirmWithRetry)(v.provider.connection,p,{skipPreflight:!0},"confirmed");case 24:case"end":return e.stop()}}),e)})));return K?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.kC,{direction:"row",position:"sticky",bottom:0,children:(0,r.jsxs)(o.Ug,{p:"10px",spacing:2,w:"full",align:"stretch",children:[K&&(0,r.jsx)(F.II,{onKeyPress:function(e){"Enter"===e.key&&(e.shiftKey?(e.preventDefault(),u((function(e){return"".concat(e,"\n")}))):(e.preventDefault(),R({type:g.MessageType.Text,text:c})))},size:"lg",value:c,onChange:function(e){e.preventDefault(),e.stopPropagation(),u(e.target.value)},placeholder:"Type Message"}),(0,r.jsx)(L,{onUpload:Q(l().mark((function e(n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R({type:g.MessageType.Image,fileAttachments:[n]});case 2:case"end":return e.stop()}}),e)})))}),(0,r.jsx)(O.hU,{size:"lg","aria-label":"Select GIF",variant:"outline",onClick:h,icon:(0,r.jsx)(p.JO,{w:"24px",h:"24px",as:D.ssH})}),(0,r.jsx)(O.zx,{colorScheme:"primary",variant:"outline",alignSelf:"flex-end",isDisabled:!K||!c,size:"lg",onClick:function(){return R({type:g.MessageType.Text,text:c})},children:(0,r.jsx)(p.JO,{as:D.gYb})})]})}),(0,r.jsx)(S.u_,{isOpen:f,onClose:x,size:"2xl",isCentered:!0,trapFocus:!0,children:(0,r.jsxs)(S.hz,{borderRadius:"xl",shadow:"xl",children:[(0,r.jsx)(S.xB,{children:"Select GIF"}),(0,r.jsx)(S.fe,{children:(0,r.jsx)(X,{onSelect:function(e){x(),R({type:g.MessageType.Gify,gifyId:e})}})})]})})]}):(0,r.jsx)(o.kC,{justify:"center",mb:"6px",children:(0,r.jsx)(M,{mint:null===C||void 0===C?void 0:C.postPermissionMint})})}var ie=t(66851),oe=t(98159),se=t(5632),ae=t(67630);function le(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(l){i=!0,o=l}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ce(e){var n=e.chatKey,t=(0,ae.R)(n).info,s=le((0,i.ac)("(max-width: 680px)"),1)[0],a=(0,y.useTokenMetadata)(null===t||void 0===t?void 0:t.readPermissionMint),l=a.metadata,c=a.image,f=(0,y.useMint)(null===t||void 0===t?void 0:t.postPermissionMint),p=(0,y.useTokenMetadata)(null===t||void 0===t?void 0:t.postPermissionMint),h=p.metadata,x=p.image,v=(0,u.If)().colorMode;return(0,r.jsx)(o.kC,{align:"center",justify:"space-between",width:"100%",p:"10px",borderBottom:"1px solid",borderColor:"light"===v?"gray.200":"gray.700",direction:"row",children:(0,r.jsxs)(o.xu,{maxWidth:"70%",pt:1,children:[(0,r.jsx)(o.X6,{size:"md",isTruncated:!0,children:null===t||void 0===t?void 0:t.name}),!s&&(0,r.jsxs)(o.Ug,{spacing:4,children:[l&&(0,r.jsxs)(o.Ug,{spacing:1,children:[(0,r.jsx)(o.xv,{fontWeight:600,children:"Read:"}),(0,r.jsx)(o.xv,{children:"hold 1"}),(0,r.jsx)(d.qE,{w:"16px",h:"16px",title:null===l||void 0===l?void 0:l.data.symbol,src:c})]}),h&&(0,r.jsxs)(o.Ug,{spacing:1,children:[(0,r.jsx)(o.xv,{fontWeight:600,children:"Post:"}),(0,r.jsxs)(o.xv,{children:[Object.keys((null===t||void 0===t?void 0:t.postPermissionAction)||{})[0]," ",(null===t||void 0===t?void 0:t.postPermissionAmount)&&f&&(0,y.roundToDecimals)((0,m.toNumber)(t.postPermissionAmount,f),4)]}),(0,r.jsx)(d.qE,{w:"16px",h:"16px",title:null===h||void 0===h?void 0:h.data.symbol,src:x})]})]})]})})}var ue=t(88712),de=t(49433);function fe(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(l){i=!0,o=l}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function pe(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function he(){var e=fe((0,i.ac)("(max-width: 768px)"),1)[0],n=(0,se.useRouter)().query.id,t=(0,s.useRef)(null),a=(0,ue.l)(n),l=(0,s.useState)([]),c=l[0],u=l[1],d=(0,de.y)(a),f=d.messages,p=d.error;(0,(0,y.useErrorHandler)().handleErrors)(p);var h=(0,s.useMemo)((function(){return new Set(Array.from((null===f||void 0===f?void 0:f.map((function(e){return e.txid})))||[]))}),[f]);return(0,s.useEffect)((function(){u((function(e){return e.filter((function(e){return!h.has(e.txid)}))}))}),[h]),(0,r.jsxs)(oe.W,{children:[!e&&(0,r.jsx)(ie.Y,{}),(0,r.jsxs)(o.kC,{direction:"column",grow:"1",height:"100vh",children:[(0,r.jsx)(o.kC,{height:"71px",children:(0,r.jsx)(ce,{chatKey:a})}),(0,r.jsx)(W,{scrollRef:t,messages:f,pendingMessages:c.filter((function(e){return!h.has(e.txid)}))}),(0,r.jsx)(re,{scrollRef:t,chatKey:a,onAddPendingMessage:function(e){return u((function(n){return pe(n||[]).concat([e])}))}})]})]})}},53260:function(){}},function(e){e.O(0,[123,766,872,898,541,326,957,774,888,179],(function(){return n=36068,e(e.s=n);var n}));var n=e.O();_N_E=n}]);